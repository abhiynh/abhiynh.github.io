<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Y N Hosakote Connect</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{font-family:'Lexend',sans-serif;background:#f5f7fb;}
.post-img{max-height:420px;object-fit:cover;width:100%;}
</style>
</head>

<body>

<!-- HEADER -->
<header class="sticky top-0 bg-white shadow z-50">
<div class="max-w-3xl mx-auto flex justify-between items-center p-4">
<h1 class="text-xl font-bold text-blue-700">Y N Hosakote Connect</h1>

<div id="authArea">
<button id="loginBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg">Login</button>
</div>
</div>
</header>

<!-- CREATE POST -->
<div id="createPost" class="hidden max-w-3xl mx-auto mt-6 bg-white p-4 rounded-xl shadow">
<textarea id="postText" placeholder="Share something..." class="w-full border p-3 rounded-lg"></textarea>

<input type="file" id="postImage" class="mt-3">

<button id="uploadPost" class="mt-4 bg-green-600 text-white px-6 py-2 rounded-lg">
Post
</button>
</div>

<!-- POSTS FEED -->
<div id="feed" class="max-w-3xl mx-auto mt-6 space-y-6"></div>

<!-- FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyCpNAu49OymCjNuRl7aRBRYQm0P6M0db0s",
  authDomain: "ynhosakote-community.firebaseapp.com",
  projectId: "ynhosakote-community",
  storageBucket: "ynhosakote-community.firebasestorage.app",
  messagingSenderId: "1053474727552",
  appId: "1:1053474727552:web:9ed2d6523ef935fd666865"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

const provider = new GoogleAuthProvider();


// LOGIN
document.getElementById("loginBtn").onclick = () => {
signInWithPopup(auth, provider);
};

// USER STATE
onAuthStateChanged(auth, user=>{
if(user){
document.getElementById("authArea").innerHTML =
`<button onclick="logout()" class="text-red-600">Logout</button>`;
document.getElementById("createPost").classList.remove("hidden");
}
});

// LOGOUT
window.logout = ()=> signOut(auth);


// UPLOAD POST
document.getElementById("uploadPost").onclick = async ()=>{

const text = document.getElementById("postText").value;
const file = document.getElementById("postImage").files[0];

let imageUrl = "";

if(file){
const storageRef = ref(storage,"posts/"+Date.now()+file.name);
await uploadBytes(storageRef,file);
imageUrl = await getDownloadURL(storageRef);
}

await addDoc(collection(db,"posts"),{
text,
imageUrl,
likes:0,
created:serverTimestamp()
});

document.getElementById("postText").value="";
alert("Posted!");
};


// LOAD POSTS REALTIME
const q = query(collection(db,"posts"),orderBy("created","desc"));

onSnapshot(q,(snapshot)=>{
const feed = document.getElementById("feed");
feed.innerHTML="";

snapshot.forEach(docu=>{
const post = docu.data();

feed.innerHTML += `
<div class="bg-white p-4 rounded-xl shadow">

<p class="text-lg mb-3">${post.text}</p>

${post.imageUrl ? `<img src="${post.imageUrl}" class="post-img rounded-lg">` : ""}

<div class="mt-4 flex justify-between items-center">
<button onclick="likePost('${docu.id}')" class="text-blue-600">üëç Like (${post.likes})</button>
</div>

</div>`;
});
});


// LIKE SYSTEM
window.likePost = async(id)=>{
const postRef = doc(db,"posts",id);
await updateDoc(postRef,{likes:increment(1)});
};

</script>
</body>
</html>