<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Village Admin Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>

</head>

<body class="bg-slate-100 font-[Public_Sans] min-h-screen">

<!-- TOP BAR -->
<div class="bg-green-600 text-white px-6 py-4 flex justify-between items-center shadow">
<h1 class="text-xl font-bold">Y N Hosakote Admin Dashboard</h1>
<button onclick="logout()" class="bg-white text-green-700 px-4 py-2 rounded-lg font-semibold">
Logout
</button>
</div>

<!-- CONTENT -->
<div class="max-w-3xl mx-auto mt-10 bg-white p-8 rounded-xl shadow">

<h2 class="text-2xl font-bold mb-4">Post New Announcement</h2>

<textarea id="notice"
class="w-full border border-gray-300 rounded-lg p-4 h-40 focus:ring-2 focus:ring-green-500 outline-none"
placeholder="Type village announcement here..."></textarea>

<button onclick="postNotice()"
class="mt-4 w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
Publish Announcement
</button>

<p id="status" class="mt-4 text-green-600 font-semibold"></p>

<hr class="my-8">

<h2 class="text-xl font-bold mb-4">Delete Latest Announcement</h2>

<button onclick="deleteLast()"
class="w-full bg-red-500 text-white py-3 rounded-lg font-semibold hover:bg-red-600">
Delete Last Announcement
</button>

</div>


<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyANO19SvpXnBRbVssgO5My_RZUGIdbV_eU",
  authDomain: "ynhosakote-portal.firebaseapp.com",
  projectId: "ynhosakote-portal",
  storageBucket: "ynhosakote-portal.firebasestorage.app",
  messagingSenderId: "590401150310",
  appId: "1:590401150310:web:1af5701c6dae674c0b7ca7"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* PROTECT PAGE */
auth.onAuthStateChanged(user=>{
if(!user){
window.location.href="admin.html";
}
});

/* POST NOTICE */
function postNotice(){

const text=document.getElementById("notice").value;

if(text.trim()==""){
alert("Please type announcement");
return;
}

db.collection("announcements").add({
message:text,
time:Date.now()
}).then(()=>{
document.getElementById("status").innerText="Announcement Published Successfully!";
document.getElementById("notice").value="";
});

}

/* DELETE LAST */
function deleteLast(){

db.collection("announcements")
.orderBy("time","desc")
.limit(1)
.get()
.then(snapshot=>{
snapshot.forEach(doc=>{
db.collection("announcements").doc(doc.id).delete();
});
document.getElementById("status").innerText="Last Announcement Deleted";
});

}

/* LOGOUT */
function logout(){
auth.signOut().then(()=>{
window.location.href="admin.html";
});
}

</script>

</body>
</html>