<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Y N Hosakote Community</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Lexend',sans-serif;
  background:#eef2f7;
}
.post-card{
  transition:all .25s ease;
}
.post-card:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
</style>
</head>

<body>

<!-- HEADER -->
<header class="bg-white shadow sticky top-0 z-50">
<div class="max-w-4xl mx-auto flex items-center justify-between px-4 py-3">

<div class="flex items-center gap-3">
<img src="logo.png" class="w-9 h-9 rounded-full">
<div>
<h1 class="font-semibold text-lg">Y N Hosakote</h1>
<p class="text-xs text-gray-500">Community Connect</p>
</div>
</div>

<button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm">
Logout
</button>

</div>
</header>


<!-- FEED -->
<main class="max-w-2xl mx-auto py-6 px-3">

<div id="postsContainer" class="space-y-6"></div>

</main>


<!-- FIREBASE SCRIPT -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/12.10.0/firebase-auth.js";

import { 
  getFirestore,
  doc,
  getDoc,
  collection,
  query,
  orderBy,
  onSnapshot
} from "https://www.gstatic.com/firebasejs/12.10.0/firebase-firestore.js";


const firebaseConfig = {
  apiKey: "AIzaSyCpNAu49OymCjNuRl7aRBRYQm0P6M0db0s",
  authDomain: "ynhosakote-community.firebaseapp.com",
  projectId: "ynhosakote-community",
  storageBucket: "ynhosakote-community.firebasestorage.app",
  messagingSenderId: "1053474727552",
  appId: "1:1053474727552:web:9ed2d6523ef935fd666865"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const postsContainer = document.getElementById("postsContainer");


// -------- SECURITY CHECK --------
onAuthStateChanged(auth, async(user)=>{

if(!user){
window.location="citizen_login.html";
return;
}

const userDoc = await getDoc(doc(db,"users",user.uid));

if(!userDoc.exists()){
window.location="citizen_login.html";
return;
}

if(userDoc.data().approved !== true){
alert("Waiting for admin approval");
window.location="citizen_login.html";
return;
}

loadPosts();

});


// -------- LOGOUT --------
document.getElementById("logoutBtn").onclick = ()=>{
signOut(auth);
window.location="citizen_login.html";
};


// -------- LOAD POSTS --------
function loadPosts(){

const q = query(collection(db,"posts"), orderBy("time","desc"));

onSnapshot(q,(snapshot)=>{

postsContainer.innerHTML="";

if(snapshot.empty){
postsContainer.innerHTML=
`<div class="text-center text-gray-500 mt-10">
No posts yet. Members will post soon.
</div>`;
return;
}

snapshot.forEach(doc=>{

const post = doc.data();
const date = new Date(post.time).toLocaleString();

const categoryColor =
post.category==="official" ? "bg-blue-600" :
post.category==="market" ? "bg-green-600" :
post.category==="events" ? "bg-purple-600" :
"bg-gray-600";

postsContainer.innerHTML += `

<div class="post-card bg-white rounded-2xl shadow border border-gray-200 overflow-hidden">

<!-- HEADER -->
<div class="flex items-center gap-3 p-4">

<div class="w-11 h-11 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold text-lg">
${post.authorName.charAt(0)}
</div>

<div class="flex-1">
<div class="flex items-center gap-2">
<p class="font-semibold">${post.authorName}</p>
<span class="text-xs text-white px-2 py-1 rounded ${categoryColor}">
${post.category ?? "general"}
</span>
</div>
<p class="text-xs text-gray-500">${date}</p>
</div>

</div>

<!-- TEXT -->
<div class="px-4 pb-3 text-gray-800 text-[15px] leading-relaxed">
${post.text}
</div>

${post.image ? `
<img src="${post.image}" class="w-full object-cover max-h-[450px]">
` : ``}

<!-- ACTIONS -->
<div class="flex justify-around text-sm text-gray-600 border-t py-3">

<button class="flex items-center gap-1 hover:text-blue-600">
üëç Like
</button>

<button class="flex items-center gap-1 hover:text-indigo-600">
üí¨ Comment
</button>

<button class="flex items-center gap-1 hover:text-green-600">
‚Üó Share
</button>

<button class="flex items-center gap-1 hover:text-red-600">
‚ö† Report
</button>

</div>

</div>
`;

});

});

}

</script>

</body>
</html>